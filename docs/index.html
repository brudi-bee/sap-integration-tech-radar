<!DOCTYPE html>
<html lang="de">
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="SAP Integration Tech Radar" />
  <title>SAP Integration Tech Radar</title>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="radar.js?v=2026-02-23-1"></script>
  <link rel="stylesheet" href="radar.css?v=2026-02-23-1" />
</head>
<body>
  <div class="topbar">
    <div>
      <strong>SAP Integration Tech Radar</strong>
      <span class="muted" id="top-muted">· Dark theme</span>
    </div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
      <label class="switch">
        <span id="lang-label">Sprache</span>
        <select id="lang-switch" style="background:#13327a;color:#eef4ff;border:1px solid rgba(160,188,255,.36);border-radius:8px;padding:3px 8px;">
          <option value="de">DE</option>
          <option value="en">EN</option>
        </select>
      </label>
    </div>
  </div>

  <svg id="radar"></svg>

  <div id="mobile-list" class="mobile-list" hidden></div>

  <table class="info-panel" id="info-panel">
    <tr>
      <td>
        <h3 id="about-title">Was ist dieses Radar?</h3>
        <p id="about-text">
          Das SAP Integration Tech Radar macht Integrations-Technologien und Architektur-Entscheidungen sichtbar.
          Es hilft Teams bei der Auswahl für neue Vorhaben und bei der Einordnung bestehender Landschaften.
        </p>

        <ul>
          <li id="ring-adopt"><strong>ADOPT</strong> — Bewährt, skalierbar, klar empfohlen.</li>
          <li id="ring-trial"><strong>TRIAL</strong> — Gute erste Erfahrungen, sinnvoll in Pilot-/Produktionsnähe.</li>
          <li id="ring-assess"><strong>ASSESS</strong> — Spannend, aber mit Evaluierungsbedarf.</li>
          <li id="ring-hold"><strong>HOLD</strong> — Für neue Implementierungen eher vermeiden.</li>
        </ul>
      </td>
      <td>
        <h3 id="usage-title">Nutzung</h3>
        <p id="usage-text">
          Desktop: nummerierte Liste neben den Quadranten; Klick öffnet Detailseite.<br/>
          Mobile: kompakter Radar + strukturierte Liste unterhalb.
        </p>
        <p>
          <a href="https://github.com/brudi-bee/sap-integration-tech-radar">Repository</a> ·
          <a href="entries.json">Entries JSON</a>
        </p>
      </td>
    </tr>
  </table>

  <script>
    const ringColors = {
      ADOPT: '#22d3ee',
      TRIAL: '#3b82f6',
      ASSESS: '#f59e0b',
      HOLD: '#ef4444'
    };

    const ringOrder = ['ADOPT', 'TRIAL', 'ASSESS', 'HOLD'];

    const i18n = {
      de: {
        topMuted: '· Dark theme',
        langLabel: 'Sprache',
        aboutTitle: 'Was ist dieses Radar?',
        aboutText: 'Das SAP Integration Tech Radar macht Integrations-Technologien und Architektur-Entscheidungen sichtbar. Es hilft Teams bei der Auswahl für neue Vorhaben und bei der Einordnung bestehender Landschaften.',
        ringAdopt: '<strong>ADOPT</strong> — Bewährt, skalierbar, klar empfohlen.',
        ringTrial: '<strong>TRIAL</strong> — Gute erste Erfahrungen, sinnvoll in Pilot-/Produktionsnähe.',
        ringAssess: '<strong>ASSESS</strong> — Spannend, aber mit Evaluierungsbedarf.',
        ringHold: '<strong>HOLD</strong> — Für neue Implementierungen eher vermeiden.',
        usageTitle: 'Nutzung',
        usageText: 'Desktop: nummerierte Liste neben den Quadranten; Klick öffnet Detailseite.<br/>Mobile: kompakter Radar + strukturierte Liste unterhalb.'
      },
      en: {
        topMuted: '· Dark theme',
        langLabel: 'Language',
        aboutTitle: 'What is this radar?',
        aboutText: 'The SAP Integration Tech Radar makes integration technologies and architecture decisions visible. It helps teams choose options for new initiatives and assess existing landscapes.',
        ringAdopt: '<strong>ADOPT</strong> — Proven, scalable, strongly recommended.',
        ringTrial: '<strong>TRIAL</strong> — Positive first outcomes, suitable for focused production-near use.',
        ringAssess: '<strong>ASSESS</strong> — Promising, but requires structured evaluation.',
        ringHold: '<strong>HOLD</strong> — Avoid for new implementations.',
        usageTitle: 'Usage',
        usageText: 'Desktop: numbered lists next to quadrants; click opens detail page.<br/>Mobile: compact radar plus structured list below.'
      }
    };

    function groupedMobileEntries(data, entries) {
      const byQuadrant = new Map();
      (data.quadrants || []).forEach((q, i) => byQuadrant.set(i, { name: q.name, items: [] }));

      entries.forEach(e => byQuadrant.get(e.quadrant)?.items.push(e));

      let html = '';
      for (const [, q] of byQuadrant) {
        html += `<section class="mobile-quadrant"><h3>${q.name}</h3>`;
        for (const ringName of ringOrder) {
          const ringIndex = ringOrder.indexOf(ringName);
          const items = q.items.filter(i => i.ring === ringIndex).sort((a,b)=>a.label.localeCompare(b.label));
          if (!items.length) continue;
          html += `<h4 style="color:${ringColors[ringName]}">${ringName}</h4><ul>`;
          items.forEach(i => {
            html += `<li><a href="${i.link}">${i.label}</a></li>`;
          });
          html += `</ul>`;
        }
        html += `</section>`;
      }
      return html;
    }

    function renderRadar(data) {
      const mobile = window.innerWidth <= 900;
      const currentLang = document.getElementById('lang-switch')?.value || 'de';

      // Dynamic desktop sizing in a bounded range
      const desktopWidth = Math.max(1450, Math.min(1750, window.innerWidth - 60));

      const entries = (data.entries || []).map((e) => ({
        ...e,
        active: e.active !== false,
        link: e.link || `details.html?item=${encodeURIComponent(e.label)}&lang=${currentLang}`
      }));

      // Keep top compact; only grow height downward when entry count increases
      const baseEntryCount = 52;
      const extraEntries = Math.max(0, entries.length - baseEntryCount);
      const desktopHeight = Math.max(1000, Math.min(1320, 1000 + extraEntries * 10));

      const rings = (data.rings || []).map((r) => ({
        ...r,
        color: ringColors[r.name] || r.color
      }));

      document.querySelector('#radar').innerHTML = '';

      radar_visualization({
        repo_url: 'https://github.com/brudi-bee/sap-integration-tech-radar',
        title: data.title || 'SAP Integration Tech Radar',
        date: data.date || '2026.02',
        width: mobile ? 1080 : desktopWidth,
        height: mobile ? 980 : desktopHeight,
        quadrants: data.quadrants,
        rings,
        entries,
        colors: {
          background: '#07153b',
          grid: '#3c74ff',
          inactive: '#203873'
        },
        theme: {
          title: '#f2f7ff',
          text: '#dbe7ff',
          muted: '#8aa5e6',
          bubble: '#0c2668'
        },
        legend_offset: mobile
          ? [{x:520,y:120},{x:-840,y:120},{x:-840,y:-330},{x:520,y:-330}]
          : [{ x: 450, y: 90 }, { x: -675, y: 90 }, { x: -675, y: -310 }, { x: 450, y: -310 }],
        title_offset: mobile ? {x:-860,y:-470} : { x: -675, y: -420 },
        footer_offset: mobile ? {x:-150,y:500} : { x: -155, y: 450 },
        legend_column_width: mobile ? 210 : 140,
        legend_line_height: mobile ? 14 : 10,
        print_layout: !mobile,
        links_in_new_tabs: false
      });

      const mobileList = document.getElementById('mobile-list');
      const infoPanel = document.getElementById('info-panel');
      if (mobile) {
        mobileList.hidden = false;
        mobileList.innerHTML = groupedMobileEntries(data, entries);
        infoPanel.style.display = 'none';
      } else {
        mobileList.hidden = true;
        mobileList.innerHTML = '';
        infoPanel.style.display = '';
      }

    }

    let cachedData = null;
    fetch('./entries.json', { cache: 'no-store' })
      .then(r => r.json())
      .then(data => {
        cachedData = data;
        const langSwitch = document.getElementById('lang-switch');
        const savedLang = localStorage.getItem('radar.lang');
        const urlLang = new URLSearchParams(window.location.search).get('lang');
        if (urlLang === 'en' || urlLang === 'de') {
          langSwitch.value = urlLang;
        } else if (savedLang === 'en' || savedLang === 'de') {
          langSwitch.value = savedLang;
        }

        function applyLanguage(lang) {
          const t = i18n[lang] || i18n.de;
          document.getElementById('top-muted').textContent = t.topMuted;
          document.getElementById('lang-label').textContent = t.langLabel;
          document.getElementById('about-title').textContent = t.aboutTitle;
          document.getElementById('about-text').textContent = t.aboutText;
          document.getElementById('ring-adopt').innerHTML = t.ringAdopt;
          document.getElementById('ring-trial').innerHTML = t.ringTrial;
          document.getElementById('ring-assess').innerHTML = t.ringAssess;
          document.getElementById('ring-hold').innerHTML = t.ringHold;
          document.getElementById('usage-title').textContent = t.usageTitle;
          document.getElementById('usage-text').innerHTML = t.usageText;
        }

        applyLanguage(langSwitch.value);
        renderRadar(cachedData);

        langSwitch.addEventListener('change', () => {
          localStorage.setItem('radar.lang', langSwitch.value);
          applyLanguage(langSwitch.value);
          const u = new URL(window.location.href);
          u.searchParams.set('lang', langSwitch.value);
          window.history.replaceState({}, '', u.toString());
        });

        window.addEventListener('resize', () => renderRadar(cachedData));
      })
      .catch((err) => {
        console.error('Error loading entries.json', err);
      });
  </script>
</body>
</html>
